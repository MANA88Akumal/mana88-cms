# MANA88 CMS Apache VirtualHost Configuration
# Add this to /opt/bitnami/apache/conf/vhosts/cms.manaakumal.com-vhost.conf

<VirtualHost *:80>
    ServerName cms.manaakumal.com
    DocumentRoot /opt/bitnami/apache/htdocs/cms
    
    <Directory /opt/bitnami/apache/htdocs/cms>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    # Redirect HTTP to HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    
    ErrorLog "/opt/bitnami/apache/logs/cms-error.log"
    CustomLog "/opt/bitnami/apache/logs/cms-access.log" combined
</VirtualHost>

<VirtualHost *:443>
    ServerName cms.manaakumal.com
    DocumentRoot /opt/bitnami/apache/htdocs/cms
    
    SSLEngine on
    SSLCertificateFile "/opt/bitnami/apache/conf/bitnami/certs/server.crt"
    SSLCertificateKeyFile "/opt/bitnami/apache/conf/bitnami/certs/server.key"
    
    <Directory /opt/bitnami/apache/htdocs/cms>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    # React Router SPA fallback
    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </IfModule>
    
    ErrorLog "/opt/bitnami/apache/logs/cms-ssl-error.log"
    CustomLog "/opt/bitnami/apache/logs/cms-ssl-access.log" combined
</VirtualHost>
